{"version":3,"file":"bs5-lightbox.js","sources":["../src/bs5-lightbox.js"],"sourcesContent":["/**\r\n * Lightbox for Bootstrap 5\r\n *\r\n * @file Creates a modal with a lightbox carousel.\r\n * @module bs5-lightbox\r\n */\r\n\r\nimport { Modal, Carousel } from 'bootstrap';\r\nconst bootstrap = {\r\n\tModal,\r\n\tCarousel\r\n};\r\nclass Lightbox {\r\n\tconstructor(el, options = {}) {\r\n\t\tthis.hash = this.randomHash();\r\n\t\tthis.settings = Object.assign(Object.assign(Object.assign({}, bootstrap.Modal.Default), bootstrap.Carousel.Default), {\r\n\t\t\tinterval: false,\r\n\t\t\ttarget: '[data-toggle=\"lightbox\"]',\r\n\t\t\tgallery: '',\r\n\t\t\tsize: 'xl',\r\n\t\t\tconstrain: true\r\n\t\t});\r\n\t\tthis.settings = Object.assign(Object.assign({}, this.settings), options);\r\n\t\tthis.modalOptions = (() => this.setOptionsFromSettings(bootstrap.Modal.Default))();\r\n\t\tthis.carouselOptions = (() => this.setOptionsFromSettings(bootstrap.Carousel.Default))();\r\n\t\tif (typeof el === 'string') {\r\n\t\t\tthis.settings.target = el;\r\n\t\t\tel = document.querySelector(this.settings.target);\r\n\t\t}\r\n\t\tthis.el = el;\r\n\t\tthis.type = el.dataset.type || '';\r\n\r\n\t\t// check for data-size attribute\r\n\t\tif (el.dataset.size) {\r\n\t\t\tthis.settings.size = el.dataset.size;\r\n\t\t}\r\n\r\n\t\tthis.src = this.getSrc(el);\r\n\t\tthis.sources = this.getGalleryItems();\r\n\t\tthis.createCarousel();\r\n\t\tthis.createModal();\r\n\t}\r\n\tshow() {\r\n\t\tdocument.body.appendChild(this.modalElement);\r\n\t\tthis.modal.show();\r\n\t}\r\n\thide() {\r\n\t\tthis.modal.hide();\r\n\t}\r\n\tsetOptionsFromSettings(obj) {\r\n\t\treturn Object.keys(obj).reduce((p, c) => Object.assign(p, { [c]: this.settings[c] }), {});\r\n\t}\r\n\tgetSrc(el) {\r\n\t\tlet src = el.dataset.src || el.dataset.remote || el.href || 'http://via.placeholder.com/1600x900';\r\n\t\tif (el.dataset.type === 'html') {\r\n\t\t\treturn src;\r\n\t\t}\r\n\t\tif (!/\\:\\/\\//.test(src)) {\r\n\t\t\tsrc = window.location.origin + src;\r\n\t\t}\r\n\t\tconst url = new URL(src);\r\n\t\tif (el.dataset.footer || el.dataset.caption) {\r\n\t\t\turl.searchParams.set('caption', el.dataset.footer || el.dataset.caption);\r\n\t\t}\r\n\t\treturn url.toString();\r\n\t}\r\n\tgetGalleryItems() {\r\n\t\tlet galleryTarget;\r\n\t\tif (this.settings.gallery) {\r\n\t\t\tif (Array.isArray(this.settings.gallery)) {\r\n\t\t\t\treturn this.settings.gallery;\r\n\t\t\t}\r\n\t\t\tgalleryTarget = this.settings.gallery;\r\n\t\t} else if (this.el.dataset.gallery) {\r\n\t\t\tgalleryTarget = this.el.dataset.gallery;\r\n\t\t}\r\n\t\tconst gallery = galleryTarget\r\n\t\t\t? [...new Set(Array.from(document.querySelectorAll(`[data-gallery=\"${galleryTarget}\"]`), (v) => `${v.dataset.type ? v.dataset.type : ''}${this.getSrc(v)}`))]\r\n\t\t\t: [`${this.type ? this.type : ''}${this.src}`];\r\n\t\treturn gallery;\r\n\t}\r\n\tgetYoutubeId(src) {\r\n\t\tif (!src) return false;\r\n\t\tconst matches = src.match(/^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/);\r\n\t\treturn matches && matches[2].length === 11 ? matches[2] : false;\r\n\t}\r\n\tgetYoutubeLink(src) {\r\n\t\tconst youtubeId = this.getYoutubeId(src);\r\n\t\tif (!youtubeId) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst arr = src.split('?');\r\n\t\tlet params = arr.length > 1 ? '?' + arr[1] : '';\r\n\t\t\r\n\t\treturn `https://www.youtube.com/embed/${youtubeId}${params}`;\r\n\t}\r\n\tgetInstagramEmbed(src) {\r\n\t\tif (/instagram/.test(src)) {\r\n\t\t\tsrc += /\\/embed$/.test(src) ? '' : '/embed';\r\n\t\t\treturn `<iframe src=\"${src}\" class=\"start-50 translate-middle-x\" style=\"max-width: 500px\" frameborder=\"0\" scrolling=\"no\" allowtransparency=\"true\"></iframe>`;\r\n\t\t}\r\n\t}\r\n\tisEmbed(src) {\r\n\t\tconst regex = new RegExp('(' + Lightbox.allowedEmbedTypes.join('|') + ')');\r\n\t\tconst isEmbed = regex.test(src);\r\n\t\tconst isImg = /\\.(png|jpe?g|gif|svg|webp)/i.test(src) || this.el.dataset.type === 'image';\r\n\r\n\t\treturn isEmbed || !isImg;\r\n\t}\r\n\tcreateCarousel() {\r\n\t\tconst template = document.createElement('template');\r\n\t\tconst types = Lightbox.allowedMediaTypes.join('|');\r\n\t\t\r\n\r\n\t\tconst slidesHtml = this.sources\r\n\t\t\t.map((src, i) => {\r\n\t\t\t\tsrc = src.replace(/\\/$/, '');\r\n\t\t\t\tconst regex = new RegExp(`^(${types})`, 'i');\r\n\t\t\t\tconst isHtml = /^html/.test(src);\r\n\t\t\t\tconst isForcedImage = /^image/.test(src);\r\n\r\n\t\t\t\tif (regex.test(src)) {\r\n\t\t\t\t\tsrc = src.replace(regex, '');\r\n\t\t\t\t}\r\n\t\t\t\tconst imgClasses = this.settings.constrain ? 'mw-100 mh-100 h-auto w-auto m-auto top-0 end-0 bottom-0 start-0' : 'h-100 w-100';\r\n\t\t\t\tconst params = new URLSearchParams(src.split('?')[1]);\r\n\t\t\t\tlet caption = '';\r\n\t\t\t\tlet url = src;\r\n\t\t\t\tif (params.get('caption')) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\turl = new URL(src);\r\n\t\t\t\t\t\turl.searchParams.delete('caption');\r\n\t\t\t\t\t\turl = url.toString();\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\turl = src;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcaption = `<div class=\"carousel-caption d-none d-md-block\" style=\"z-index:2\"><p class=\"bg-secondary rounded\">${params.get('caption')}</p></div>`;\r\n\t\t\t\t}\r\n\t\t\t\tlet inner = `<img src=\"${url}\" class=\"d-block ${imgClasses} img-fluid\" style=\"z-index: 1; object-fit: contain;\" />`;\r\n\t\t\t\tlet attributes = '';\r\n\t\t\t\tconst instagramEmbed = this.getInstagramEmbed(src);\r\n\t\t\t\tconst youtubeLink = this.getYoutubeLink(src);\r\n\t\t\t\tif (this.isEmbed(src) && !isForcedImage) {\r\n\t\t\t\t\tif (youtubeLink) {\r\n\t\t\t\t\t\tsrc = youtubeLink;\r\n\t\t\t\t\t\tattributes = 'title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer autoplay clipboard-write encrypted-media gyroscope picture-in-picture\"';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinner = instagramEmbed || `<img src=\"${src}\" ${attributes} class=\"d-block mw-100 mh-100 h-auto w-auto m-auto top-0 end-0 bottom-0 start-0 img-fluid\" style=\"z-index: 1; object-fit: contain;\" />`;\r\n\t\t\t\t}\r\n\t\t\t\tif (isHtml) {\r\n\t\t\t\t\tinner = src;\r\n\t\t\t\t}\r\n\t\t\t\tconst spinner = `<div class=\"position-absolute top-50 start-50 translate-middle text-white\"><div class=\"spinner-border\" style=\"width: 3rem height: 3rem\" role=\"status\"></div></div>`;\r\n\t\t\t\treturn `\r\n\t\t\t\t<div class=\"carousel-item ${!i ? 'active' : ''}\" style=\"min-height: 100px\">\r\n\t\t\t\t\t${spinner}\r\n\t\t\t\t\t<div class=\"ratio ratio-16x9\" style=\"background-color: #000;\">${inner}</div>\r\n\t\t\t\t\t${caption}\r\n\t\t\t\t</div>`;\r\n\t\t\t})\r\n\t\t\t.join('');\r\n\r\n        const controlsHtml =\r\n            this.sources.length < 2\r\n                ? ''\r\n                : `\r\n\t\t\t<button id=\"#lightboxCarousel-${this.hash\r\n                }-prev\" class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#lightboxCarousel-${\r\n                this.hash}\" data-bs-slide=\"prev\">\r\n\t\t\t\t<span class=\"btn btn-secondary carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n\t\t\t\t<span class=\"visually-hidden\">Previous</span>\r\n\t\t\t</button>\r\n\t\t\t<button id=\"#lightboxCarousel-${this.hash\r\n                }-next\" class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#lightboxCarousel-${\r\n                this.hash}\" data-bs-slide=\"next\">\r\n\t\t\t\t<span class=\"btn btn-secondary carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n\t\t\t\t<span class=\"visually-hidden\">Next</span>\r\n\t\t\t</button>`;\r\n    \r\n\t\tlet classes = 'lightbox-carousel carousel slide';\r\n\t\tif (this.settings.size === 'fullscreen') {\r\n\t\t\tclasses += ' position-absolute w-100 translate-middle top-50 start-50';\r\n\t\t}\r\n        const indicatorsHtml = `\r\n\t\t\t<div class=\"carousel-indicators\" style=\"bottom: -40px\">\r\n\t\t\t\t${this.sources.map((_, index) => `\r\n\t\t\t\t\t<button type=\"button\" data-bs-target=\"#lightboxCarousel-${this.hash}\" data-bs-slide-to=\"${index}\" class=\"${index === 0 ? 'active' : ''}\" aria-current=\"${index === 0 ? 'true' : 'false'}\" aria-label=\"Slide ${index + 1}\"></button>\r\n\t\t\t\t`).join('')}\r\n\t\t\t</div>`;\r\n\t\tconst html = `\r\n\t\t\t<div id=\"lightboxCarousel-${this.hash}\" class=\"${classes}\" data-bs-ride=\"carousel\" data-bs-interval=\"${this.carouselOptions.interval}\">\r\n\t\t\t    <div class=\"carousel-inner\">\r\n\t\t\t\t\t${slidesHtml}\r\n\t\t\t\t</div>\r\n\t\t\t    ${indicatorsHtml}\r\n\t\t\t\t${controlsHtml}\r\n\t\t\t</div>`;\r\n\t\ttemplate.innerHTML = html.trim();\r\n\t\tthis.carouselElement = template.content.firstChild;\r\n\t\tconst carouselOptions = Object.assign(Object.assign({}, this.carouselOptions), { keyboard: false });\r\n\t\tthis.carousel = new bootstrap.Carousel(this.carouselElement, carouselOptions);\r\n\t\tconst elSrc = this.type && this.type !== 'image' ? this.type + this.src : this.src;\r\n\t\tthis.carousel.to(this.findGalleryItemIndex(this.sources, elSrc));\r\n\t\tif (this.carouselOptions.keyboard === true) {\r\n\t\t\tdocument.addEventListener('keydown', (e) => {\r\n\t\t\t\tif (e.code === 'ArrowLeft') {\r\n\t\t\t\t\tconst prev = document.getElementById(`#lightboxCarousel-${this.hash}-prev`);\r\n\t\t\t\t\tif (prev) {\r\n\t\t\t\t\t\tprev.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (e.code === 'ArrowRight') {\r\n\t\t\t\t\tconst next = document.getElementById(`#lightboxCarousel-${this.hash}-next`);\r\n\t\t\t\t\tif (next) {\r\n\t\t\t\t\t\tnext.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.carousel;\r\n\t}\r\n\tfindGalleryItemIndex(haystack, needle) {\r\n\t\tlet index = 0;\r\n\t\tfor (const item of haystack) {\r\n\t\t\tif (item.includes(needle)) {\r\n\t\t\t\treturn index;\r\n\t\t\t}\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\tcreateModal() {\r\n\t\tconst template = document.createElement('template');\r\n\t\tconst html = `\r\n\t\t\t<div class=\"modal lightbox fade\" id=\"lightboxModal-${this.hash}\" tabindex=\"-1\" aria-hidden=\"true\">\r\n\t\t\t\t<div class=\"modal-dialog modal-dialog-centered modal-${this.settings.size}\">\r\n\t\t\t\t\t<div class=\"modal-content border-0 bg-transparent\">\r\n\t\t\t\t\t\t<div class=\"modal-body p-0\">\r\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-close position-absolute p-3\" data-bs-dismiss=\"modal\" aria-label=\"Close\" style=\"top: -15px;right:-40px\"></button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`;\r\n\t\ttemplate.innerHTML = html.trim();\r\n\t\tthis.modalElement = template.content.firstChild;\r\n\t\tthis.modalElement.querySelector('.modal-body').appendChild(this.carouselElement);\r\n\t\tthis.modalElement.addEventListener('hidden.bs.modal', () => this.modalElement.remove());\r\n\t\tthis.modalElement.querySelector('[data-bs-dismiss]').addEventListener('click', () => this.modal.hide());\r\n\t\tthis.modal = new bootstrap.Modal(this.modalElement, this.modalOptions);\r\n\t\treturn this.modal;\r\n\t}\r\n\trandomHash(length = 8) {\r\n\t\treturn Array.from({ length }, () => Math.floor(Math.random() * 36).toString(36)).join('');\r\n\t}\r\n}\r\nLightbox.allowedEmbedTypes = ['embed', 'youtube', 'vimeo', 'instagram', 'url'];\r\nLightbox.allowedMediaTypes = [...Lightbox.allowedEmbedTypes, 'image', 'html'];\r\nLightbox.defaultSelector = '[data-toggle=\"lightbox\"]';\r\nLightbox.initialize = function (e) {\r\n\te.preventDefault();\r\n\tconst lightbox = new Lightbox(this);\r\n\tlightbox.show();\r\n};\r\ndocument.querySelectorAll(Lightbox.defaultSelector).forEach((el) => el.addEventListener('click', Lightbox.initialize));\r\nif (typeof window !== 'undefined' && window.bootstrap) {\r\n\twindow.bootstrap.Lightbox = Lightbox;\r\n}\r\nexport default Lightbox;"],"names":["bootstrap","Modal","Carousel","Lightbox","el","options","obj","p","c","src","url","galleryTarget","v","matches","youtubeId","arr","params","isEmbed","isImg","template","types","slidesHtml","regex","isHtml","isForcedImage","imgClasses","caption","inner","attributes","instagramEmbed","youtubeLink","controlsHtml","classes","indicatorsHtml","_","index","html","carouselOptions","elSrc","e","prev","next","haystack","needle","item","length"],"mappings":"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"}