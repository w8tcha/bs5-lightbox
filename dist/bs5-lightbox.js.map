{"version":3,"file":"bs5-lightbox.js","sources":["../src/bs5-lightbox.ts"],"sourcesContent":["/**\r\n * Lightbox for Bootstrap 5\r\n *\r\n * @file Creates a modal with a lightbox carousel.\r\n * @module bs5-lightbox\r\n */\r\n\r\nimport * as bootstrap from \"bootstrap\";\r\nimport LightboxOptions from \"./interfaces/lightboxOptions\";\r\n\r\nclass Lightbox {\r\n  private hash: string;\r\n  private settings: LightboxOptions;\r\n  private modalOptions: bootstrap.Modal.Options;\r\n  private carouselOptions: bootstrap.Carousel.Options;\r\n  private el: HTMLElement;\r\n  private src: string;\r\n  private sources: string[];\r\n  private type: string;\r\n  private carouselElement!: HTMLElement;\r\n  private modalElement!: HTMLElement;\r\n  private modal!: bootstrap.Modal;\r\n  private carousel!: bootstrap.Carousel;\r\n\r\n  static allowedEmbedTypes = [\"embed\", \"youtube\", \"vimeo\", \"instagram\", \"url\"];\r\n  static allowedMediaTypes = [...Lightbox.allowedEmbedTypes, \"image\", \"html\"];\r\n  static defaultSelector = '[data-toggle=\"lightbox\"]';\r\n\r\n  constructor(\r\n    el: HTMLElement | string,\r\n    options: Partial<LightboxOptions> = {}\r\n  ) {\r\n    this.hash = this.randomHash();\r\n    this.settings = Object.assign(\r\n      {},\r\n      bootstrap.Modal.Default,\r\n      bootstrap.Carousel.Default,\r\n      {\r\n        interval: false,\r\n        target: '[data-toggle=\"lightbox\"]',\r\n        gallery: \"\",\r\n        size: \"xl\",\r\n        constrain: true,\r\n      },\r\n      options\r\n    );\r\n\r\n    this.modalOptions = this.setOptionsFromSettings(bootstrap.Modal.Default);\r\n    this.carouselOptions = this.setOptionsFromSettings(\r\n      bootstrap.Carousel.Default\r\n    );\r\n\r\n    if (typeof el === \"string\") {\r\n      this.settings.target = el;\r\n      el = document.querySelector(el) as HTMLElement;\r\n    }\r\n\r\n    this.el = el;\r\n    this.type = el.dataset.type || \"\";\r\n\r\n    if (el.dataset.size) {\r\n      this.settings.size = el.dataset.size;\r\n    }\r\n\r\n    this.src = this.getSrc(el);\r\n    this.sources = this.getGalleryItems();\r\n    this.createCarousel();\r\n    this.createModal();\r\n  }\r\n\r\n  show(): void {\r\n    document.body.appendChild(this.modalElement);\r\n    this.modal.show();\r\n  }\r\n\r\n  hide(): void {\r\n    this.modal.hide();\r\n  }\r\n\r\n  private setOptionsFromSettings(obj: any): any {\r\n    return Object.keys(obj).reduce(\r\n      (p: any, c: string) => Object.assign(p, { [c]: this.settings[c] }),\r\n      {}\r\n    );\r\n  }\r\n\r\n  private getSrc(el: HTMLElement): string {\r\n    let src =\r\n      el.dataset.src ||\r\n      el.dataset.remote ||\r\n      (el as HTMLAnchorElement).href ||\r\n      \"http://via.placeholder.com/1600x900\";\r\n\r\n    if (el.dataset.type === \"html\") return src;\r\n\r\n    if (!/https?:\\/\\//.test(src)) {\r\n      src = window.location.origin + src;\r\n    }\r\n\r\n    const url = new URL(src);\r\n    if (el.dataset.footer || el.dataset.caption) {\r\n      url.searchParams.set(\r\n        \"caption\",\r\n        el.dataset.footer || el.dataset.caption || \"\"\r\n      );\r\n    }\r\n\r\n    return url.toString();\r\n  }\r\n\r\n  private getGalleryItems(): string[] {\r\n    let galleryTarget: string | undefined;\r\n\r\n    if (this.settings.gallery) {\r\n      if (Array.isArray(this.settings.gallery)) return this.settings.gallery;\r\n      galleryTarget = this.settings.gallery;\r\n    } else if (this.el.dataset.gallery) {\r\n      galleryTarget = this.el.dataset.gallery;\r\n    }\r\n\r\n    const gallery = galleryTarget\r\n      ? [\r\n          ...new Set(\r\n            Array.from(\r\n              document.querySelectorAll(`[data-gallery=\"${galleryTarget}\"]`),\r\n              (v: Element) => {\r\n                const el = v as HTMLElement;\r\n                return `${el.dataset.type || \"\"}${this.getSrc(el)}`;\r\n              }\r\n            )\r\n          ),\r\n        ]\r\n      : [`${this.type || \"\"}${this.src}`];\r\n\r\n    return gallery;\r\n  }\r\n\r\n  private getYoutubeId(src: string): string | false {\r\n    const matches = src.match(\r\n      /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/\r\n    );\r\n    return matches && matches[2].length === 11 ? matches[2] : false;\r\n  }\r\n\r\n  private getYoutubeLink(src: string): string | false {\r\n    const youtubeId = this.getYoutubeId(src);\r\n    if (!youtubeId) return false;\r\n\r\n    const arr = src.split(\"?\");\r\n    const params = arr.length > 1 ? `?${arr[1]}` : \"\";\r\n\r\n    return `https://www.youtube.com/embed/${youtubeId}${params}`;\r\n  }\r\n\r\n  private getInstagramEmbed(src: string): string | undefined {\r\n    if (/instagram/.test(src)) {\r\n      src += /\\/embed$/.test(src) ? \"\" : \"/embed\";\r\n      return `<iframe src=\"${src}\" class=\"start-50 translate-middle-x\" style=\"max-width: 500px\" frameborder=\"0\" scrolling=\"no\" allowtransparency=\"true\"></iframe>`;\r\n    }\r\n  }\r\n\r\n  private isEmbed(src: string): boolean {\r\n    const regex = new RegExp(`(${Lightbox.allowedEmbedTypes.join(\"|\")})`);\r\n    const isEmbed = regex.test(src);\r\n    const isImg =\r\n      /\\.(png|jpe?g|gif|svg|webp)/i.test(src) ||\r\n      this.el.dataset.type === \"image\";\r\n\r\n    return isEmbed || !isImg;\r\n  }\r\n\r\n  private createCarousel(): bootstrap.Carousel {\r\n    const template = document.createElement(\"template\");\r\n    const types = Lightbox.allowedMediaTypes.join(\"|\");\r\n\r\n    const slidesHtml = this.sources\r\n      .map((src, i) => {\r\n        src = src.replace(/\\/$/, \"\");\r\n        const regex = new RegExp(`^(${types})`, \"i\");\r\n        const isHtml = /^html/.test(src);\r\n        const isForcedImage = /^image/.test(src);\r\n\r\n        if (regex.test(src)) {\r\n          src = src.replace(regex, \"\");\r\n        }\r\n\r\n        const imgClasses = this.settings.constrain\r\n          ? \"mw-100 mh-100 h-auto w-auto m-auto top-0 end-0 bottom-0 start-0\"\r\n          : \"h-100 w-100\";\r\n\r\n        const params = new URLSearchParams(src.split(\"?\")[1]);\r\n        let caption = \"\";\r\n        let url = src;\r\n\r\n        if (params.get(\"caption\")) {\r\n          try {\r\n            url = new URL(src).toString().replace(`?${params}`, \"\");\r\n            caption = `<div class=\"carousel-caption d-none d-md-block\" style=\"z-index:2\"><p class=\"bg-secondary rounded\">${params.get(\r\n              \"caption\"\r\n            )}</p></div>`;\r\n          } catch {\r\n            url = src;\r\n          }\r\n        }\r\n\r\n        let inner = `<img src=\"${url}\" class=\"d-block ${imgClasses} img-fluid\" style=\"z-index: 1; object-fit: contain;\" />`;\r\n        let attributes = \"\";\r\n        const instagramEmbed = this.getInstagramEmbed(src);\r\n        const youtubeLink = this.getYoutubeLink(src);\r\n\r\n        if (this.isEmbed(src) && !isForcedImage) {\r\n          if (youtubeLink) {\r\n            src = youtubeLink;\r\n            attributes =\r\n              'title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer autoplay clipboard-write encrypted-media gyroscope picture-in-picture\"';\r\n          }\r\n          inner =\r\n            instagramEmbed ||\r\n            `<img src=\"${src}\" ${attributes} class=\"d-block mw-100 mh-100 h-auto w-auto m-auto top-0 end-0 bottom-0 start-0 img-fluid\" style=\"z-index: 1; object-fit: contain;\" />`;\r\n        }\r\n\r\n        if (isHtml) {\r\n          inner = src;\r\n        }\r\n\r\n        const spinner = `<div class=\"position-absolute top-50 start-50 translate-middle text-white\"><div class=\"spinner-border\" style=\"width: 3rem; height: 3rem\" role=\"status\"></div></div>`;\r\n\r\n        return `\r\n          <div class=\"carousel-item ${\r\n            !i ? \"active\" : \"\"\r\n          }\" style=\"min-height: 100px\">\r\n            ${spinner}\r\n            <div class=\"ratio ratio-16x9\" style=\"background-color: #000;\">${inner}</div>\r\n            ${caption}\r\n          </div>`;\r\n      })\r\n      .join(\"\");\r\n\r\n    const controlsHtml =\r\n      this.sources.length < 2\r\n        ? \"\"\r\n        : `\r\n        <button id=\"#lightboxCarousel-${this.hash}-prev\" class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#lightboxCarousel-${this.hash}\" data-bs-slide=\"prev\">\r\n          <span class=\"btn btn-primary carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n          <span class=\"visually-hidden\">Previous</span>\r\n        </button>\r\n        <button id=\"#lightboxCarousel-${this.hash}-next\" class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#lightboxCarousel-${this.hash}\" data-bs-slide=\"next\">\r\n          <span class=\"btn btn-primary carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n          <span class=\"visually-hidden\">Next</span>\r\n        </button>`;\r\n\r\n    const indicatorsHtml = `\r\n      <div class=\"carousel-indicators\" style=\"bottom: -40px\">\r\n        ${this.sources\r\n          .map(\r\n            (_, index) => `\r\n            <button type=\"button\" data-bs-target=\"#lightboxCarousel-${\r\n              this.hash\r\n            }\" data-bs-slide-to=\"${index}\" class=\"${\r\n              index === 0 ? \"active\" : \"\"\r\n            }\" aria-current=\"${\r\n              index === 0 ? \"true\" : \"false\"\r\n            }\" aria-label=\"Slide ${index + 1}\"></button>`\r\n          )\r\n          .join(\"\")}\r\n      </div>`;\r\n\r\n    template.innerHTML = `\r\n      <div id=\"lightboxCarousel-${this.hash}\" class=\"lightbox-carousel carousel slide\" data-bs-ride=\"carousel\" data-bs-interval=\"${this.carouselOptions.interval}\">\r\n        <div class=\"carousel-inner\">${slidesHtml}</div>\r\n        ${indicatorsHtml}\r\n        ${controlsHtml}\r\n      </div>`.trim();\r\n\r\n    this.carouselElement = template.content.firstChild as HTMLElement;\r\n\r\n    const options: bootstrap.Carousel.Options = {\r\n      ...this.carouselOptions,\r\n      keyboard: false,\r\n    };\r\n\r\n    this.carousel = new bootstrap.Carousel(this.carouselElement, options);\r\n\r\n    const elSrc =\r\n      this.type && this.type !== \"image\" ? this.type + this.src : this.src;\r\n    this.carousel.to(this.findGalleryItemIndex(this.sources, elSrc));\r\n\r\n    if (this.carouselOptions.keyboard === true) {\r\n      document.addEventListener(\"keydown\", (e: KeyboardEvent) => {\r\n        if (e.code === \"ArrowLeft\") {\r\n          document\r\n            .getElementById(`#lightboxCarousel-${this.hash}-prev`)\r\n            ?.click();\r\n          return false;\r\n        }\r\n        if (e.code === \"ArrowRight\") {\r\n          document\r\n            .getElementById(`#lightboxCarousel-${this.hash}-next`)\r\n            ?.click();\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n\r\n    return this.carousel;\r\n  }\r\n\r\n  private findGalleryItemIndex(haystack: string[], needle: string): number {\r\n    return haystack.findIndex((item) => item.includes(needle)) || 0;\r\n  }\r\n\r\n  private createModal(): bootstrap.Modal {\r\n    const template = document.createElement(\"template\");\r\n    template.innerHTML = `\r\n      <div class=\"modal lightbox fade\" id=\"lightboxModal-${this.hash}\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog modal-dialog-centered modal-${this.settings.size}\">\r\n          <div class=\"modal-content border-0 bg-transparent\">\r\n            <div class=\"modal-body p-0\">\r\n              <button type=\"button\" class=\"btn-close position-absolute p-3\" data-bs-dismiss=\"modal\" aria-label=\"Close\" style=\"top: -15px;right:-40px\"></button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>`.trim();\r\n\r\n    this.modalElement = template.content.firstChild as HTMLElement;\r\n    this.modalElement\r\n      .querySelector(\".modal-body\")\r\n      ?.appendChild(this.carouselElement);\r\n\r\n    this.modalElement.addEventListener(\"hidden.bs.modal\", () =>\r\n      this.modalElement.remove()\r\n    );\r\n    this.modalElement\r\n      .querySelector(\"[data-bs-dismiss]\")\r\n      ?.addEventListener(\"click\", () => this.modal.hide());\r\n\r\n    this.modal = new bootstrap.Modal(this.modalElement, this.modalOptions);\r\n    return this.modal;\r\n  }\r\n\r\n  private randomHash(length = 8): string {\r\n    return Array.from({ length }, () =>\r\n      Math.floor(Math.random() * 36).toString(36)\r\n    ).join(\"\");\r\n  }\r\n\r\n  static initialize(this: HTMLElement, e: Event): void {\r\n    e.preventDefault();\r\n    const lightbox = new Lightbox(this);\r\n    lightbox.show();\r\n  }\r\n}\r\n\r\ndocument\r\n  .querySelectorAll(Lightbox.defaultSelector)\r\n  .forEach((el) => el.addEventListener(\"click\", Lightbox.initialize));\r\n\r\nif (typeof window !== \"undefined\" && (window as any).bootstrap) {\r\n  (window as any).bootstrap.Lightbox = Lightbox;\r\n}\r\n\r\nexport default Lightbox;\r\n"],"names":["_Lightbox","el","options","__publicField","bootstrap","obj","p","c","src","url","galleryTarget","v","matches","youtubeId","arr","params","isEmbed","isImg","template","types","slidesHtml","i","regex","isHtml","isForcedImage","imgClasses","caption","inner","attributes","instagramEmbed","youtubeLink","controlsHtml","indicatorsHtml","_","index","elSrc","e","_a","_b","haystack","needle","item","length","Lightbox"],"mappings":"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"}